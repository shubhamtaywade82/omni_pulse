# Omni Pulse

A **monolithic Rails 8 application** that fuses a Hotwire chat UI, a JSON-first API, and AI-powered automation.
Think of Omni Pulse as your personal command desk—ready to integrate large-language-model smarts, portfolio data, or any future workflow you dream up.

---

## Table of Contents

1. [Key Features](#key-features)
2. [Project Roadmap ✅ / ☑️](#project-roadmap--️)
3. [Quick Start](#quick-start)
4. [Architecture Overview](#architecture-overview)
5. [Directory Layout](#directory-layout)
6. [Development Workflow](#development-workflow)
7. [Deployment Guide](#deployment-guide)
8. [Environment Variables](#environment-variables)
9. [Contributing](#contributing)
10. [License](#license)

---

## Key Features

| Pillar                 | Highlights                                                                                         |
| ---------------------- | -------------------------------------------------------------------------------------------------- |
| **Hotwire UI**         | Turbo Streams + Tailwind give a snappy, SPA-like chat interface with zero React/Vue overhead.      |
| **JSON API**           | `/api/v1/*` namespace exposes the same features programmatically—perfect for scripts and webhooks. |
| **LLM Adapter**        | Plug-and-play OpenAI (GPT-4o) wrapper with streaming; ready for function-calling workflows.        |
| **Trading Adapter**    | Modular `DhanClient` service (v2 REST) for holdings, quotes, and order placement.                  |
| **Dev & Test Tooling** | RSpec, FactoryBot, RuboCop, Bullet, Overcommit hooks, GitHub Actions CI with Postgres + Brakeman.  |
| **First-class Docs**   | ADR folder, full README, and autogenerated schema annotations keep knowledge in-repo.              |

---

## Project Roadmap ✅ / ☑️

| Area                   | Task                                             | Status |
| ---------------------- | ------------------------------------------------ | ------ |
| **Core Rails**         | Rails 8 skeleton with Tailwind + ESBuild         | ✅      |
|                        | PostgreSQL database & ENV-driven config          | ✅      |
|                        | Turbo/Hotwire chat UI scaffolding                | ☑️     |
| **API**                | Versioned namespace `/api/v1`                    | ✅      |
|                        | Chat endpoint (`POST /api/v1/chat`)              | ☑️     |
|                        | Dhan endpoints (`GET /holdings`, `POST /orders`) | ☑️     |
| **AI**                 | `OpenaiChatService` wrapper                      | ☑️     |
|                        | Streaming ActionCable job                        | ☑️     |
|                        | Function-calling schema (invoke trading ops)     | ☐      |
| **Trading**            | `DhanClient` service (holdings)                  | ☑️     |
|                        | Place/modify/cancel order helpers                | ☐      |
|                        | Risk-guardrails layer (max loss, qty limits)     | ☐      |
| **Quality & Security** | RuboCop + Overcommit pre-commit hooks            | ✅      |
|                        | Brakeman static analysis in CI                   | ✅      |
|                        | Bullet N+1 alerts in dev                         | ✅      |
| **Testing**            | RSpec setup & first model specs                  | ✅      |
|                        | FactoryBot fixtures                              | ☑️     |
|                        | Feature specs (Turbo chat flow)                  | ☐      |
| **Docs**               | ADR 0001 (architecture decisions)                | ✅      |
|                        | Usage tutorials in `docs/`                       | ☐      |

Legend: **✅ done** · **☑️ in-progress** · **☐ next up**

---

## Quick Start

```bash
# 1. Clone & bootstrap
git clone https://github.com/your-org/omni_pulse.git
cd omni_pulse
bin/setup        # installs gems, JS deps, prepares DB, installs git hooks

# 2. Configure secrets
bin/rails credentials:edit
# → add OPENAI_API_KEY, DHAN_CLIENT_ID, DHAN_ACCESS_TOKEN

# 3. Run dev servers (Rails + Tailwind + ESBuild)
bin/dev          # foreman start

# 4. Visit http://localhost:3000
```

### Running Tests & Linters

```bash
bundle exec rubocop       # style & lint
bundle exec rspec         # full spec suite
bin/brakeman --no-pager   # security scan
```

---

## Architecture Overview

```text
┌─────────────┐    Turbo Streams    ┌──────────────┐
│  Browser UI │◀───────────────────▶│ Action Cable │
└─────────────┘                     └──────┬───────┘
                                           │
                                           ▼
                                ┌─────────────────────┐
                                │  Chat Controller    │
                                │  (HTML & JSON)      │
                                └────────┬────────────┘
                                         │ invokes
                                 Stream   ▼
                              ┌─────────────────────┐
                              │ OpenaiChatService   │───▶ OpenAI API (GPT-4o)
                              └─────────────────────┘
                                         │ (function-call)
                                         ▼
                              ┌─────────────────────┐
                              │   DhanClient        │───▶ DhanHQ v2 REST
                              └─────────────────────┘
```

---

## Directory Layout

```
app/
 ├─controllers/            HTML + API controllers
 ├─models/                 ActiveRecord models
 ├─views/                  ERB / Turbo partials
 ├─services/               OpenAI & Dhan wrappers
 ├─jobs/                   Background streaming job
 ├─channels/               Action Cable channel
config/
 ├─routes.rb               = UI + API endpoints
 └─credentials/            = encrypted secrets
.github/workflows/         = CI pipeline
docs/                      = ADRs, guides, diagrams
```

---

## Development Workflow

| Step                 | Tool                                                             |
| -------------------- | ---------------------------------------------------------------- |
| **Pre-commit**       | `overcommit` runs RuboCop + Annotate                             |
| **CI**               | GitHub Actions: Brakeman → RuboCop → RSpec (Postgres 15 service) |
| **Formatting**       | RuboCop Rails/Performance/RSpec cops (`bin/rubocop -A`)          |
| **Database hygiene** | `database_cleaner` + FactoryBot in tests                         |
| **Security**         | Brakeman + Dependabot alerts                                     |

---

## Deployment Guide

| Target         | Command hints                                                          |
| -------------- | ---------------------------------------------------------------------- |
| **Render.com** | Add Postgres & Redis services → `render.yaml` build + start            |
| **Fly.io**     | `fly launch` → set secrets → attach Postgres cluster                   |
| **Docker**     | `docker compose up -d` (auto-built because Rails 8 ships `Dockerfile`) |
| **Heroku**     | `heroku create` → `heroku addons:create heroku-postgresql`             |

Remember to set `OPENAI_API_KEY`, `DHAN_*` creds, and `RAILS_MASTER_KEY` in your platform’s secret manager.

---

## Environment Variables

| Key                 | Purpose                                       |
| ------------------- | --------------------------------------------- |
| `OPENAI_API_KEY`    | Bearer token for GPT-4o calls                 |
| `OPENAI_ORG_ID`     | (optional) OpenAI org for cost tracking       |
| `DHAN_CLIENT_ID`    | DhanHQ user ID                                |
| `DHAN_ACCESS_TOKEN` | Secure token from Dhan developer portal       |
| `DATABASE_URL`      | Override default Postgres DSN (CI/production) |

---

## Contributing

1. Fork → feature branch (`feat/xyz`)
2. `bundle exec rubocop && bundle exec rspec` must pass
3. Open a PR; GitHub Actions will run CI.
4. Once approved, squash-merge into `main`.

See `docs/adr/*` before proposing large architectural changes.

---

## License

This project is released under the **MIT License**. See [`LICENSE`](LICENSE) for details.
